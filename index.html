<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì—¬ë¦„ ì²­ì¶˜ ì‹œë®¬ë ˆì´í„°</title>
<style>
  body {
    font-family: 'Noto Sans KR', sans-serif;
    background: linear-gradient(to bottom, #e0f7ff, #cce7ff);
    margin:0; padding:0;
    display:flex; height:100vh;
  }
  #leftPanel, #rightPanel {
    padding:15px;
    box-sizing:border-box;
  }
  #leftPanel {
    width:35%; background:#f0f8ff; overflow-y:auto;
    border-right:2px solid #b3e0ff;
  }
  #rightPanel {
    width:65%; background:#ffffff; overflow-y:auto;
    position:relative;
  }
  h1 { text-align:center; color:#0077b6; margin-bottom:10px; }
  .card { background:#fff; padding:10px 15px; border-radius:8px; margin-bottom:10px; box-shadow:1px 1px 5px rgba(0,0,0,0.1);}
  button { margin:3px; padding:5px 10px; border-radius:5px; border:none; cursor:pointer; background:#0096c7; color:white; font-weight:bold;}
  button:hover{background:#0077b6;}
  input[type="text"], input[type="number"] { padding:5px; width:90%; margin:3px 0; border-radius:4px; border:1px solid #ccc;}
  #dateDisplay { text-align:center; font-size:1.2em; color:#005f73; margin-bottom:10px; }
  #logContent { padding:10px; max-height:80%; overflow-y:auto; }
  .log-date{ font-weight:bold; margin-bottom:5px; }
  .event-card { background:#cce7ff; padding:8px; margin-top:5px; border-radius:6px; }
  .relation-card { background:#ffb3b3; padding:8px; margin-top:5px; border-radius:6px; }
  .grade-selector { display:flex; align-items:center; margin:5px 0; }
</style>
</head>
<body>

<div id="leftPanel">
  <h1>í•™ìƒ ëª…ë‹¨ & ê´€ê³„ë„</h1>
  <div id="main"></div>
  <button onclick="showAdd()">â• ìºë¦­í„° ì¶”ê°€</button>
  <button onclick="showRelationships()">ğŸ‘¥ ê´€ê³„ë„ ë³´ê¸°</button>
</div>

<div id="rightPanel">
  <div id="dateDisplay"></div>
  <div style="text-align:center;">
    <button onclick="nextDay()">â¡ ë‹¤ìŒ ë‚ </button>
    <button onclick="showDailyLog()">ğŸ“– ì˜¤ëŠ˜ ì¼ê³¼ ë³´ê¸°</button>
    <button onclick="clearDailyLogs()">ğŸ—‘ï¸ ê¸°ë¡ ì‚­ì œ</button>
  </div>
  <div id="logContent"></div>
</div>

<script>
// ---------------- state ----------------
let state = {
  date: new Date(2026, 3, 21), // 4ì›” 21ì¼ ì‹œì‘
  characters: [],
  dailyLogs: [],
  events:[ // ì‚¬ìš©ìê°€ ì§€ì •í•œ ì¼ì •
    {start:'4/21', end:'4/24', name:'1í•™ê¸° ì¤‘ê°„ê³ ì‚¬'},
    {start:'6/14', end:'6/18', name:'1í•™ê¸° ê¸°ë§ê³ ì‚¬'},
    {start:'7/2', end:'8/1', name:'ì—¬ë¦„ë°©í•™'},
    {start:'8/23', end:'8/25', name:'ìˆ˜í•™ì—¬í–‰'},
    {start:'9/4', end:'9/4', name:'ì²´ìœ¡ëŒ€íšŒ'},
    {start:'10/21', end:'10/25', name:'2í•™ê¸° ì¤‘ê°„ê³ ì‚¬'},
    {start:'12/11', end:'12/15', name:'2í•™ê¸° ê¸°ë§ê³ ì‚¬'},
    {start:'2/14', end:'2/14', name:'ì¢…ì—…ì‹/ì¡¸ì—…ì‹'},
    {start:'2/15', end:'3/1', name:'ë´„ë°©í•™'}
  ]
};

// ---------------- ìœ í‹¸ ----------------
function formatDate(d){
  const month=d.getMonth()+1; const day=d.getDate();
  return `${month}ì›” ${day}ì¼`;
}
function getSeason(d){
  const m = d.getMonth()+1;
  if(m>=3&&m<=5) return "ë´„";
  if(m>=6&&m<=8) return "ì—¬ë¦„";
  if(m>=9&&m<=11) return "ê°€ì„";
  return "ê²¨ìš¸";
}
function updateDateDisplay(){
  const dateStr = formatDate(state.date);
  const season = getSeason(state.date);
  const ev = getEventForDate(state.date);
  document.getElementById("dateDisplay").innerText = `ğŸ“… ${dateStr} Â· ${season}${ev? " Â· "+ev:""}`;
}
function getEventForDate(d){
  const m=d.getMonth()+1; const day=d.getDate();
  for(let e of state.events){
    const [sm, sd] = e.start.split('/').map(Number);
    const [em, ed] = e.end.split('/').map(Number);
    if((m>sm || (m===sm && day>=sd)) && (m<em || (m===em && day<=ed))) return e.name;
  }
  return "";
}

// ---------------- ë‹¤ìŒ ë‚  ----------------
async function nextDay(){
  const prevMonth=state.date.getMonth();
  state.date.setDate(state.date.getDate()+1);

  // í•˜ë£¨ì¼ê³¼ ìƒì„±
  await generateDailyLog();

  updateDateDisplay();
}

// ---------------- í•™ìƒ ëª…ë‹¨ ----------------
function showStudents(){
  let html="";
  if(state.characters.length===0){
    html="í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.";
  } else {
    state.characters.forEach((c,i)=>{
      html+=`<div class="card">
        <b>${c.name || "ì´ë¦„ ì—†ìŒ"}</b> (${c.grade}í•™ë…„)<br>
        <div class="grade-selector">
          <button onclick="changeGrade(${i},-1)">â—€</button>
          ${c.grade}í•™ë…„
          <button onclick="changeGrade(${i},1)">â–¶</button>
        </div>
        ì„±ê²©: ${c.personality.join(", ")}<br>
        <button onclick="editChar(${i})">âœï¸ ìˆ˜ì •</button>
        <button onclick="removeChar(${i})">âŒ ì‚­ì œ</button>
      </div>`;
    });
  }
  document.getElementById("main").innerHTML=html;
}
function changeGrade(i,delta){
  let g=state.characters[i].grade+delta;
  if(g<1) g=1; if(g>3) g=3;
  state.characters[i].grade=g;
  showStudents();
}

// ---------------- ìºë¦­í„° ê´€ë¦¬ ----------------
function showAdd(){
  document.getElementById("main").innerHTML=`
    <div class="card">
      ì´ë¦„ <input id="charName" type="text"><br>
      í•™ë…„ <input id="grade" type="number" min="1" max="3" value="1"><br>
      ì„±ê²© í‚¤ì›Œë“œ(ì‰¼í‘œ) <input id="per" type="text"><br>
      <button onclick="addChar()">ì¶”ê°€</button>
    </div>`;
}
function addChar(){
  const name=(document.getElementById("charName").value||"").trim();
  const grade=Number(document.getElementById("grade").value);
  const personality=(document.getElementById("per").value||"").split(",").map(s=>s.trim()).filter(Boolean);
  if(!name || !grade || personality.length===0){ alert("ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”."); return;}
  let relationships={}; // ì´ˆê¸° í˜¸ê°ë„
  state.characters.forEach(c=>relationships[c.name]=0);
  state.characters.push({name,grade,personality,graduated:false,postGrad:null,relationships,eventTriggered:[]});
  showStudents();
}
function editChar(i){
  const c=state.characters[i];
  document.getElementById("main").innerHTML=`
    <div class="card">
      ì´ë¦„ <input id="charName" type="text" value="${c.name}"><br>
      í•™ë…„ <input id="grade" type="number" min="1" max="3" value="${c.grade}"><br>
      ì„±ê²© í‚¤ì›Œë“œ <input id="per" type="text" value="${c.personality.join(", ")}"><br>
      <button onclick="saveChar(${i})">ì €ì¥</button>
    </div>`;
}
function saveChar(i){
  const name=(document.getElementById("charName").value||"").trim();
  const grade=Number(document.getElementById("grade").value);
  const personality=(document.getElementById("per").value||"").split(",").map(s=>s.trim()).filter(Boolean);
  if(!name || !grade || personality.length===0){ alert("ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”."); return;}
  state.characters[i].name=name; state.characters[i].grade=grade; state.characters[i].personality=personality;
  showStudents();
}
function removeChar(i){ if(confirm("ì‚­ì œí• ê¹Œìš”?")){state.characters.splice(i,1); showStudents();} }

// ---------------- ê´€ê³„ë„ í‘œì‹œ ----------------
function showRelationships(){
  if(state.characters.length<2){ alert("ìºë¦­í„°ê°€ 2ëª… ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤."); return;}
  let html="<div class='card'><b>ê´€ê³„ë„</b><br>";
  state.characters.forEach(c=>{
    html+=c.name+" ê´€ê³„:<br>";
    for(let other in c.relationships){
      html+=other+":"+c.relationships[other]+"<br>";
    }
  });
  html+="</div>";
  document.getElementById("main").innerHTML=html;
}

// ---------------- í•˜ë£¨ì¼ê³¼ ê¸°ë¡ ----------------
function showDailyLog(){ document.getElementById("logContent").scrollTop=document.getElementById("logContent").scrollHeight; }
function clearDailyLogs(){ if(confirm("ê¸°ë¡ ì‚­ì œ?")){state.dailyLogs=[]; document.getElementById("logContent").innerHTML="";} }

// ---------------- AI/ëœë¤ í•˜ë£¨ì¼ê³¼ ----------------
async function generateDailyLog(){
  const dateStr=formatDate(state.date);
  const season=getSeason(state.date);
  const ev=getEventForDate(state.date)||"í‰ë²”í•œ í•˜ë£¨";
  let logHTML="";
  
  state.characters.forEach(c=>{
    let moods=["ì¦ê²ê²Œ","ì¡°ê¸ˆ í”¼ê³¤í•˜ì§€ë§Œ","í™œë°œí•˜ê²Œ","ì„¤ë ˆëŠ” ë§ˆìŒìœ¼ë¡œ"];
    let actions=["ìˆ˜ì—…ì„ ë“¤ì—ˆë‹¤","ì¹œêµ¬ì™€ ìˆ˜ë‹¤ë¥¼ ë–¨ì—ˆë‹¤","ìš´ë™ì¥ì—ì„œ ì‹œê°„ì„ ë³´ëƒˆë‹¤","ì ì‹¬ì‹œê°„ì— ê°„ì‹ì„ ë¨¹ì—ˆë‹¤"];
    logHTML+=`<div><span class="log-date">${dateStr} - ${c.name}</span><br>ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ${season} ë¶„ìœ„ê¸° ì†ì—ì„œ ${ev}ë¥¼ ë³´ë‚´ë©°, ${moods[Math.floor(Math.random()*moods.length)]} ${actions[Math.floor(Math.random()*actions.length)]}.</div>`;
    
    // ìºë¦­í„° ìƒí˜¸ì‘ìš©
    state.characters.forEach(other=>{
      if(c!==other){
        let inc=Math.floor(Math.random()*5);
        c.relationships[other.name]=(c.relationships[other.name]||0)+inc;
        
        // í˜¸ê°ë„ ì´ë²¤íŠ¸
        if(c.relationships[other.name]>=70 && !c.eventTriggered.includes(other.name)){
          c.eventTriggered.push(other.name);
          logHTML+=`<div class="event-card">${c.name}ê³¼ ${other.name}ì´ ê¸¸ì—ì„œ ìš°ì—°íˆ ë§Œë‚˜ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ê³  ë‹¤ìŒ ë‚ ë¶€í„° í•¨ê»˜ í•˜êµí•˜ê¸°ë¡œ í–ˆë‹¤.</div>`;
        }
        
        // ê´€ê³„ ë³€í™” (í˜¸ê°ë„ ë³€í™”)
        if(inc>0){
          logHTML+=`<div class="relation-card">${c.name}ê³¼ ${other.name}ì˜ ê´€ê³„ê°€ ì¡°ê¸ˆ ê°€ê¹Œì›Œì¡Œë‹¤ (+${inc})</div>`;
        }
      }
    });
  });
  
  state.dailyLogs.push(logHTML);
  document.getElementById("logContent").innerHTML=state.dailyLogs.join("");
  document.getElementById("logContent").scrollTop=document.getElementById("logContent").scrollHeight;
}

updateDateDisplay();
showStudents();
</script>

</body>
</html>
