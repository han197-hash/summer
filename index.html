<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì—¬ë¦„ ì²­ì¶˜ ì‹œë®¬ë ˆì´í„°</title>
<style>
  /* í°íŠ¸, ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
  @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap');
  body {
    margin:0; padding:0; font-family: 'Gowun Dodum', sans-serif;
    background: #e0f2f7;
    color: #333;
    display: flex; flex-direction: column; height: 100vh;
  }
  header {
    background: #74b9ff;
    color: white; padding: 12px 20px; font-size: 1.5rem;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  #container {
    flex: 1; display: flex; padding: 10px; gap: 12px;
  }
  #leftPanel, #rightPanel {
    background: white;
    border-radius: 14px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.07);
    padding: 16px;
    display: flex; flex-direction: column;
  }
  #leftPanel {
    flex-basis: 350px;
    max-width: 350px;
  }
  #rightPanel {
    flex: 1;
  }
  h2 {
    margin: 0 0 12px 0;
    color: #0984e3;
    font-weight: 700;
    text-align: center;
  }
  #studentList {
    flex: 1;
    overflow-y: auto;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }
  .studentCard {
    background: #dff9fb;
    border-radius: 10px;
    padding: 8px 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    display: flex; flex-direction: column;
  }
  .studentCard strong {
    font-size: 1.1rem;
    color: #0984e3;
  }
  .traitList {
    margin: 6px 0 0 0;
    font-size: 0.85rem;
    color: #555;
  }
  .relStatus {
    margin-top: 6px;
    font-size: 0.8rem;
    color: #666;
    white-space: pre-line;
  }
  .btn-group {
    margin-top: 8px;
    display: flex; gap: 8px;
  }
  button {
    cursor: pointer;
    border: none;
    border-radius: 8px;
    padding: 6px 12px;
    font-size: 0.85rem;
    font-weight: 600;
    background: #74b9ff;
    color: white;
    transition: background 0.2s;
  }
  button:hover {
    background: #0984e3;
  }
  .btn-danger {
    background: #d63031;
  }
  .btn-danger:hover {
    background: #e17055;
  }
  #cancelEditBtn {
    background: #636e72;
  }
  #cancelEditBtn:hover {
    background: #2d3436;
  }
  form {
    margin-top: 16px;
    background: #f1f6f9;
    padding: 12px;
    border-radius: 12px;
  }
  label {
    display: block;
    font-weight: 600;
    margin-top: 8px;
  }
  input[type="text"], input[type="number"], select {
    width: 100%;
    border-radius: 6px;
    border: 1.5px solid #bbb;
    padding: 6px 8px;
    font-size: 1rem;
    margin-top: 4px;
  }
  input[type="text"]:focus, input[type="number"]:focus, select:focus {
    outline: none;
    border-color: #0984e3;
    box-shadow: 0 0 4px #74b9ff;
  }
  #traitsContainer {
    margin-top: 8px;
    min-height: 28px;
    display: flex; flex-wrap: wrap; gap: 6px;
  }
  .traitTag {
    background: #81ecec;
    padding: 4px 8px;
    border-radius: 16px;
    font-size: 0.85rem;
    color: #0984e3;
    user-select: none;
  }
  #initialLikesContainer {
    margin-top: 8px;
    max-height: 100px;
    overflow-y: auto;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 6px 10px;
  }
  .likeRow {
    display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;
  }
  .likeRow label {
    flex: 1;
  }
  .likeRow input {
    width: 60px;
    padding: 4px 6px;
    border-radius: 6px;
    border: 1.2px solid #bbb;
    text-align: center;
  }
  #dateTitle {
    font-weight: 700;
    text-align: center;
    margin-bottom: 8px;
    font-size: 1.2rem;
    color: #0984e3;
  }
  #dayLog {
    flex: 1;
    background: white;
    border-radius: 12px;
    padding: 12px;
    overflow-y: auto;
    font-size: 0.9rem;
    line-height: 1.4;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.04);
    margin-top: 10px;
  }
  .popup {
    padding: 8px 10px;
    border-radius: 10px;
    margin-bottom: 8px;
    line-height: 1.3;
    box-sizing: border-box;
  }
  .likeUp {
    background: #d6eaf8;
    color: #21618c;
  }
  .likeDown {
    background: #f5b7b1;
    color: #b03a2e;
  }
  .relationChange {
    background: #dcd6f7;
    color: #4a3f99;
  }
  #btns {
    margin-top: 12px;
    display: flex; justify-content: center; gap: 20px;
  }
</style>
</head>
<body>
<header>ì—¬ë¦„ ì²­ì¶˜ ì‹œë®¬ë ˆì´í„°</header>
<div id="container">
  <section id="leftPanel">
    <h2>í•™ìƒ ê´€ë¦¬</h2>
    <div id="studentList" title="í•™ìƒ ëª…ë‹¨"></div>
    <form id="charForm" autocomplete="off">
      <h3 id="formTitle">ìºë¦­í„° ì¶”ê°€</h3>
      <label for="charNameInput">ì´ë¦„</label>
      <input type="text" id="charNameInput" required placeholder="ì´ë¦„ ì…ë ¥" />
      <label for="charAgeInput">ë‚˜ì´</label>
      <input type="number" id="charAgeInput" min="10" max="30" value="16" required />
      <label for="charGradeSelect">í•™ë…„</label>
      <select id="charGradeSelect">
        <option value="1">1í•™ë…„</option>
        <option value="2">2í•™ë…„</option>
        <option value="3">3í•™ë…„</option>
      </select>
      <label for="traitInput">ì„±ê²© í‚¤ì›Œë“œ (ì—”í„°ë¡œ ì¶”ê°€)</label>
      <input type="text" id="traitInput" placeholder="ì˜ˆ: í™œë°œí•œ" />
      <div id="traitsContainer"></div>

      <label>ì´ˆê¸° í˜¸ê°ë„ ì„¤ì •</label>
      <div id="initialLikesContainer" title="ë‹¤ë¥¸ ìºë¦­í„°ì— ëŒ€í•œ ì´ˆê¸° í˜¸ê°ë„ ì…ë ¥"></div>

      <div id="btns">
        <button type="submit" id="addCharBtn">ì¶”ê°€</button>
        <button type="button" id="cancelEditBtn" style="display:none;">ì·¨ì†Œ</button>
      </div>
    </form>
  </section>

  <section id="rightPanel">
    <div id="dateTitle">í˜„ì¬ ë‚ ì§œ: 3ì›” 2ì¼ (ì…í•™ì‹)</div>
    <div id="dayLog"></div>
    <div id="btns">
      <button id="nextDayBtn">ë‹¤ìŒ ë‚ </button>
      <button id="clearLogBtn">ê¸°ë¡ ì‚­ì œ</button>
    </div>
  </section>
</div>

<script>
  const state = {
    characters: [],
    editingIndex: null,
    currentDate: new Date(new Date().getFullYear(), 2, 2),
  };

  // ì´ë²¤íŠ¸ ì¼ì • ê°„ëµ ì˜ˆì‹œ
  const events = [
    {name: 'ì…í•™ì‹', start: '2023-03-02', end: '2023-03-02'},
    {name: '1í•™ê¸° ì¤‘ê°„ê³ ì‚¬', start: '2023-04-21', end: '2023-04-24'},
    {name: '1í•™ê¸° ê¸°ë§ê³ ì‚¬', start: '2023-06-14', end: '2023-06-18'},
    {name: 'ì—¬ë¦„ë°©í•™', start: '2023-07-02', end: '2023-08-01'},
    {name: 'ìˆ˜í•™ì—¬í–‰', start: '2023-08-23', end: '2023-08-25'},
    {name: 'ì²´ìœ¡ëŒ€íšŒ', start: '2023-09-04', end: '2023-09-04'},
    {name: '2í•™ê¸° ì¤‘ê°„ê³ ì‚¬', start: '2023-10-21', end: '2023-10-25'},
    {name: '2í•™ê¸° ê¸°ë§ê³ ì‚¬', start: '2023-12-11', end: '2023-12-15'},
    {name: 'ì¢…ì—…ì‹/ì¡¸ì—…ì‹', start: '2024-02-14', end: '2024-02-14'},
    {name: 'ë´„ë°©í•™', start: '2024-02-15', end: '2024-03-01'},
  ];

  const studentListDiv = document.getElementById('studentList');
  const charForm = document.getElementById('charForm');
  const charNameInput = document.getElementById('charNameInput');
  const charAgeInput = document.getElementById('charAgeInput');
  const charGradeSelect = document.getElementById('charGradeSelect');
  const traitInput = document.getElementById('traitInput');
  const traitsContainer = document.getElementById('traitsContainer');
  const initialLikesContainer = document.getElementById('initialLikesContainer');
  const addCharBtn = document.getElementById('addCharBtn');
  const cancelEditBtn = document.getElementById('cancelEditBtn');
  const dateTitle = document.getElementById('dateTitle');
  const dayLog = document.getElementById('dayLog');
  const nextDayBtn = document.getElementById('nextDayBtn');
  const clearLogBtn = document.getElementById('clearLogBtn');

  let currentTraits = [];

  traitInput.addEventListener('keydown', e => {
    if(e.key === 'Enter'){
      e.preventDefault();
      const val = traitInput.value.trim();
      if(val && !currentTraits.includes(val)){
        currentTraits.push(val);
        renderTraits();
        traitInput.value = '';
      }
    }
  });

  function renderTraits(){
    traitsContainer.innerHTML = '';
    currentTraits.forEach(trait => {
      const span = document.createElement('span');
      span.className = 'traitTag';
      span.textContent = trait;
      traitsContainer.appendChild(span);
    });
  }

  function updateInitialLikesUI(){
    initialLikesContainer.innerHTML = '';
    const editingIdx = state.editingIndex;
    const curCharName = editingIdx !== null ? state.characters[editingIdx].name : null;
    state.characters.forEach(char => {
      if(char.name === curCharName) return;
      const div = document.createElement('div');
      div.className = 'likeRow';
      const label = document.createElement('label');
      label.textContent = char.name;
      const input = document.createElement('input');
      input.type = 'number';
      input.min = -50;
      input.max = 100;
      input.value = editingIdx !== null ? (state.characters[editingIdx].relationships[char.name] || 0) : 0;
      input.dataset.target = char.name;
      div.appendChild(label);
      div.appendChild(input);
      initialLikesContainer.appendChild(div);
    });
  }

  function renderStudentList(){
    studentListDiv.innerHTML = '';
    state.characters.forEach((char, idx) => {
      const card = document.createElement('div');
      card.className = 'studentCard';
      const nameElem = document.createElement('strong');
      nameElem.textContent = `${char.name} (${char.grade}í•™ë…„)`;
      card.appendChild(nameElem);
      const ageElem = document.createElement('div');
      ageElem.textContent = `ë‚˜ì´: ${char.age}`;
      card.appendChild(ageElem);
      const traitElem = document.createElement('div');
      traitElem.className = 'traitList';
      traitElem.textContent = 'ì„±ê²©: ' + (char.traits.length ? char.traits.join(', ') : '-');
      card.appendChild(traitElem);

      // ê´€ê³„ ìƒíƒœ ë° í˜¸ê°ë„ ìˆ˜ì¹˜ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œ
      const relDiv = document.createElement('div');
      relDiv.className = 'relStatus';
      let relStr = '';
      for(let targetName in char.relationships){
        const val = char.relationships[targetName];
        let status = 'ë¬´ê´€ì‹¬';
        if(val >= 80) status = 'ì•½í˜¼ì';
        else if(val >= 50) status = 'ì—°ì¸';
        else if(val >= 20) status = 'ì¸';
        else if(val > 0) status = 'ì§ì‚¬ë‘';
        else if(val < 0) status = 'ì ëŒ€';
        relStr += `${targetName}: ${status} (${val})\n`;
      }
      relDiv.textContent = relStr.trim();
      card.appendChild(relDiv);

      const btnGroup = document.createElement('div');
      btnGroup.className = 'btn-group';

      const editBtn = document.createElement('button');
      editBtn.textContent = 'ìˆ˜ì •';
      editBtn.onclick = () => {
        state.editingIndex = idx;
        charNameInput.value = char.name;
        charAgeInput.value = char.age;
        charGradeSelect.value = char.grade;
        charGradeSelect.disabled = true;
        currentTraits = [...char.traits];
        renderTraits();
        addCharBtn.textContent = 'ìˆ˜ì •';
        cancelEditBtn.style.display = 'inline-block';
        updateInitialLikesUI();
      };
      btnGroup.appendChild(editBtn);

      const delBtn = document.createElement('button');
      delBtn.textContent = 'ì‚­ì œ';
      delBtn.className = 'btn-danger';
      delBtn.onclick = () => {
        if(confirm(`${char.name} ìºë¦­í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){
          state.characters.forEach(c => {
            delete c.relationships[char.name];
          });
          state.characters.splice(idx, 1);
          if(state.editingIndex === idx){
            resetForm();
          }
          renderStudentList();
        }
      };
      btnGroup.appendChild(delBtn);
      card.appendChild(btnGroup);

      studentListDiv.appendChild(card);
    });
  }

  function resetForm(){
    charForm.reset();
    charGradeSelect.disabled = false;
    currentTraits = [];
    renderTraits();
    state.editingIndex = null;
    addCharBtn.textContent = 'ì¶”ê°€';
    cancelEditBtn.style.display = 'none';
    updateInitialLikesUI();
  }

  charForm.addEventListener('submit', e => {
    e.preventDefault();
    const name = charNameInput.value.trim();
    const age = Number(charAgeInput.value);
    const grade = Number(charGradeSelect.value);
    const traits = [...currentTraits];

    if(!name) return alert('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.');

    if(state.editingIndex !== null){
      const char = state.characters[state.editingIndex];
      char.name = name;
      char.age = age;
      char.traits = traits;
      // í˜¸ê°ë„ ì—…ë°ì´íŠ¸
      const inputs = initialLikesContainer.querySelectorAll('input');
      inputs.forEach(input => {
        const target = input.dataset.target;
        char.relationships[target] = Number(input.value);
      });
      resetForm();
    } else {
      // ìƒˆ ìºë¦­í„° ì¶”ê°€
      const newChar = {
        name, age, grade, traits,
        relationships: {}
      };
      // ì´ˆê¸° í˜¸ê°ë„ 0ìœ¼ë¡œ ì±„ìš°ê¸°
      state.characters.forEach(c => {
        c.relationships[name] = 0;
        newChar.relationships[c.name] = 0;
      });
      state.characters.push(newChar);
      resetForm();
    }
    renderStudentList();
  });

  cancelEditBtn.addEventListener('click', () => {
    resetForm();
  });

  // ë‚ ì§œ í‘œì‹œ ë° ë‹¤ìŒë‚  ë²„íŠ¼ ê¸°ëŠ¥ (ìƒëµ, ê¸°ì¡´ ë°©ì‹ ì‚¬ìš©)
  // ì´ë²¤íŠ¸ ë° ì„œìˆ  ìƒì„±ë„ ê¸°ì¡´ ë°©ì‹ ìœ ì§€
  // ...
  // ì•„ë˜ì— ì´ì „ì²˜ëŸ¼ ë‚ ì§œ ì§„í–‰, ì´ë²¤íŠ¸ ì²´í¬, ì„œìˆ  ìƒì„± ë¡œì§ êµ¬í˜„í•˜ì„¸ìš”.

  // ë¡œê·¸ ê¸°ë¡ ì´ˆê¸°í™” ë²„íŠ¼
  clearLogBtn.addEventListener('click', () => {
    if(confirm('ì§€ê¸ˆê¹Œì§€ì˜ ê¸°ë¡ì„ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
      dayLog.textContent = '';
    }
  });

nextDayBtn.addEventListener('click', () => {
    // ë‚ ì§œ ì¦ê°€
    state.currentDate.setDate(state.currentDate.getDate() + 1);
    const month = state.currentDate.getMonth() + 1;
    const date = state.currentDate.getDate();
    const curDateStr = state.currentDate.toISOString().slice(0,10);

    // ì˜¤ëŠ˜ ì´ë²¤íŠ¸ í™•ì¸
    const todayEvents = events.filter(ev => curDateStr >= ev.start && curDateStr <= ev.end);
    let eventText = todayEvents.length ? ` (${todayEvents.map(e=>e.name).join(', ')})` : '';
    dateTitle.textContent = `í˜„ì¬ ë‚ ì§œ: ${month}ì›” ${date}ì¼${eventText}`;

    // ë¡œê·¸ ìƒì„±
    const logs = [];

    // 1. ì´ë²¤íŠ¸ ê¸°ë°˜ í•˜ë£¨ ì„œìˆ 
    if(todayEvents.length){
        todayEvents.forEach(ev => {
            logs.push(`ğŸ“… ì˜¤ëŠ˜ì€ ${ev.name}ê°€ ìˆëŠ” ë‚ ì´ë‹¤. í•™ìƒë“¤ì´ ë°”ì˜ê²Œ ì›€ì§ì˜€ë‹¤.`);
        });
    } else {
        // ëœë¤ ì¼ìƒ
        const dailyActivities = [
            'ì˜¤ëŠ˜ì€ í‰ë²”í•œ í•˜ë£¨ì˜€ë‹¤. êµì‹¤ì—ì„œ ìˆ˜ì—…ì„ ë“£ê³  ì¹œêµ¬ë“¤ê³¼ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ´ë‹¤.',
            'ì ì‹¬ì‹œê°„ì— ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ê°„ì‹ì„ ë‚˜ëˆ ë¨¹ì—ˆë‹¤.',
            'ë°©ê³¼ í›„ ìš´ë™ì¥ì—ì„œ ë›°ì–´ë†€ë©° ì¦ê±°ìš´ ì‹œê°„ì„ ë³´ëƒˆë‹¤.',
            'ë„ì„œê´€ì—ì„œ ì¡°ìš©íˆ ì±…ì„ ì½ì—ˆë‹¤.'
        ];
        const randomActivity = dailyActivities[Math.floor(Math.random()*dailyActivities.length)];
        logs.push(randomActivity);
    }

    // 2. ìºë¦­í„° ê°„ í˜¸ê°ë„ ë³€í™”
    for(let i=0; i<state.characters.length; i++){
        for(let j=i+1; j<state.characters.length; j++){
            const c1 = state.characters[i];
            const c2 = state.characters[j];

            // ëœë¤ ë³€í™”ëŸ‰: -5 ~ +5
            const delta = Math.floor(Math.random()*11) - 5;
            c1.relationships[c2.name] = (c1.relationships[c2.name] || 0) + delta;
            c2.relationships[c1.name] = (c2.relationships[c1.name] || 0) + delta;

            if(delta > 0){
                logs.push(`â¤ï¸ ${c1.name}ì™€ ${c2.name}ì˜ í˜¸ê°ë„ê°€ ${delta}ë§Œí¼ ì˜¬ëë‹¤.`);
            } else if(delta < 0){
                logs.push(`ğŸ’” ${c1.name}ì™€ ${c2.name}ì˜ í˜¸ê°ë„ê°€ ${-delta}ë§Œí¼ ë–¨ì–´ì¡Œë‹¤.`);
            } else {
                logs.push(`ğŸ¤ ${c1.name}ì™€ ${c2.name}ì˜ ê´€ê³„ëŠ” ë³€í™”ê°€ ì—†ì—ˆë‹¤.`);
            }
        }
    }

    // 3. ë¡œê·¸ í‘œì‹œ
    logs.forEach(log => {
        const div = document.createElement('div');
        if(log.includes('â¤ï¸')) div.className = 'likeUp';
        else if(log.includes('ğŸ’”')) div.className = 'likeDown';
        else div.className = 'relationChange';
        div.textContent = log;
        dayLog.prepend(div);
    });

    renderStudentList();
});


    dateTitle.textContent = `í˜„ì¬ ë‚ ì§œ: ${month}ì›” ${date}ì¼${todayEventName ? ' (' + todayEventName + ')' : ''}`;

    // ì˜¤ëŠ˜ ì‚¬ê±´, ì„œìˆ  ëœë¤ ìƒì„± (ì—¬ê¸°ì„œ í˜¸ê°ë„ ì¦ê°, ê´€ê³„ ë³€í™” ë¡œê·¸ ìƒì„±)
    // ê°„ë‹¨ ì˜ˆì‹œ:
    const logs = [];

    // ì˜ˆì‹œ - ê³µë¶€ ì´ë²¤íŠ¸
    if(todayEventName.includes('ì¤‘ê°„ê³ ì‚¬') || todayEventName.includes('ê¸°ë§ê³ ì‚¬')){
      logs.push(`ì˜¤ëŠ˜ì€ ${todayEventName} ê¸°ê°„ì´ë¼ ì—´ì‹¬íˆ ê³µë¶€í–ˆë‹¤. ì–´ë ¤ìš´ ë¬¸ì œì—ì„œ ë§‰í˜”ë‹¤.`);
    }

    // ì˜ˆì‹œ - ë¹„ ì˜¤ëŠ” ë‚ ê³¼ ìš°ì‚° ì´ë²¤íŠ¸ (ì„ì˜ë¡œ ë‚ ì§œ ì¡°ê±´ ì„¤ì •)
    if(month === 4 && date === 15){ // ì„ì˜ë¡œ 4ì›” 15ì¼ ë¹„ì˜¤ëŠ” ë‚  ì˜ˆì‹œ
      logs.push('ë¹„ê°€ ì™”ì§€ë§Œ ìš°ì‚°ì„ ê°€ì ¸ì˜¤ì§€ ì•Šì•˜ë‹¤. ê·¸ëŸ¬ë‚˜ ã…‡ã…‡ì´ê°€ ìš°ì‚°ì„ ê°™ì´ ì“°ìê³  ì œì•ˆí–ˆë‹¤.');
    }

    // í˜¸ê°ë„ ë³€í™”(ì„ì˜ ëœë¤, ì‹¤ì œëŠ” ì‚¬ìš©ì ì´ë²¤íŠ¸ì— ë”°ë¼ ë‹¤ë¦„)
    if(state.characters.length >= 2){
      const c1 = state.characters[0];
      const c2 = state.characters[1];
      // í˜¸ê°ë„ 5 ì¦ê°€
      c1.relationships[c2.name] = (c1.relationships[c2.name] || 0) + 5;
      c2.relationships[c1.name] = (c2.relationships[c1.name] || 0) + 5;
      logs.push(`â¤ï¸ ${c1.name}ì™€ ${c2.name}ì˜ í˜¸ê°ë„ê°€ 5ë§Œí¼ ì˜¬ëë‹¤.`);
    }

    // ê¸°ë¡ ë„ìš°ê¸°
    logs.forEach(log => {
      const div = document.createElement('div');
      div.className = log.includes('â¤ï¸') ? 'relationChange' : 'likeUp';
      div.textContent = log;
      dayLog.prepend(div);
    });

    renderStudentList();
  });

  // ì´ˆê¸°í™”
  resetForm();
  renderStudentList();

</script>
</body>
</html>
