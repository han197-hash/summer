<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì—¬ë¦„ ì²­ì¶˜ ì‹œë®¬ë ˆì´í„°</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">

<style>
:root {
  --bg-pastel: #e3f6fc;
  --card-bg: #ffffff;
  --border: #b3e5fc;
  --btn-bg: #4dabf7;
  --btn-hover: #228be6;
  --text-color: #012a4a;
  --event-card: #d0f4ff;
  --relation-card: #ffd8d8;
}
body {
  margin: 0;
  font-family: 'Gowun Dodum', sans-serif;
  background: var(--bg-pastel);
  color: var(--text-color);
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* ================= LAYOUT ================= */
#leftPanel, #rightPanel {
  padding: 12px;
  box-sizing: border-box;
}

#leftPanel {
  width: 35%;
  border-right: 3px solid var(--border);
  overflow-y: auto;
}

#rightPanel {
  width: 65%;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
}

h1 {
  text-align: center;
  font-size: 1.8em;
  margin-bottom: 8px;
  color: var(--btn-bg);
}

/* ================= BUTTONS ================= */
button {
  background: var(--btn-bg);
  border: none;
  border-radius: 12px;
  color: white;
  padding: 7px 12px;
  margin: 4px;
  font-size: 0.95em;
  cursor: pointer;
}
button:hover {
  background: var(--btn-hover);
}

/* ================= CARDS ================= */
.card {
  background: var(--card-bg);
  border-radius: 12px;
  padding: 10px;
  box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
  margin-bottom: 8px;
}

/* ================= LAYOUT PANELS ================= */
#dateDisplay {
  font-size: 1.2em;
  text-align: center;
  margin: 6px 0;
  font-weight: bold;
}

#studentList {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}

input[type="text"], input[type="number"] {
  width: 95%;
  padding: 6px;
  border-radius: 8px;
  border: 1px solid #ccc;
  margin: 4px 0;
}

/* ================= LOGS ================= */
#logHeader {
  text-align: center;
  font-weight: bold;
  margin: 8px 0;
}
#logContent {
  overflow-y: auto;
  flex-grow: 1;
  padding: 8px;
}

/* ================= SPECIAL CARDS ================= */
.event-card {
  background: var(--event-card);
  border-radius: 8px;
  padding: 6px;
  margin-top: 5px;
}
.relation-card {
  background: var(--relation-card);
  border-radius: 8px;
  padding: 6px;
  margin-top: 5px;
}

</style>
</head>
<body>

<!-- ===== LEFT PANEL ===== -->
<div id="leftPanel">
  <h1>í•™ìƒ ëª…ë‹¨</h1>
  <div id="studentList"></div>
  <button onclick="showAddForm()">â• ìºë¦­í„° ì¶”ê°€</button>
  <button onclick="displayRelations()">ğŸ‘¥ ê´€ê³„ë„</button>
</div>

<!-- ===== RIGHT PANEL ===== -->
<div id="rightPanel">
  <div id="dateDisplay"></div>
  <div style="text-align:center;">
    <button onclick="advanceDay()">â¡ ë‹¤ìŒ ë‚ </button>
    <button onclick="scrollToLogs()">ğŸ“– ì „ì²´ ê¸°ë¡</button>
    <button onclick="clearLogs()">ğŸ—‘ï¸ ê¸°ë¡ ì‚­ì œ</button>
  </div>
  <div id="logHeader">ğŸ“œ í•˜ë£¨ ì¼ê³¼ ê¸°ë¡</div>
  <div id="logContent"></div>
</div>

<script>
// ================= STATE =================
let state = {
  date: new Date(2026, 2, 2), // 3ì›” 2ì¼
  characters: [],
  dailyLogs: [],
  events: [
    {start:'4/21', end:'4/24', name:'1í•™ê¸° ì¤‘ê°„ê³ ì‚¬'},
    {start:'6/14', end:'6/18', name:'1í•™ê¸° ê¸°ë§ê³ ì‚¬'},
    {start:'7/2', end:'8/1', name:'ì—¬ë¦„ë°©í•™'},
    {start:'8/23', end:'8/25', name:'ìˆ˜í•™ì—¬í–‰'},
    {start:'9/4', end:'9/4', name:'ì²´ìœ¡ëŒ€íšŒ'},
    {start:'10/21', end:'10/25', name:'2í•™ê¸° ì¤‘ê°„ê³ ì‚¬'},
    {start:'12/11', end:'12/15', name:'2í•™ê¸° ê¸°ë§ê³ ì‚¬'},
    {start:'2/14', end:'2/14', name:'ì¢…ì—…ì‹/ì¡¸ì—…ì‹'},
    {start:'2/15', end:'3/1', name:'ë´„ë°©í•™'}
  ]
};

// =============== DATE/SEASON/EVENT HELPERS ===============
function formatDate(d){
  let m=d.getMonth()+1, day=d.getDate();
  return `${m}ì›” ${day}ì¼`;
}
function getSeason(d){
  let m=d.getMonth()+1;
  if(m>=3 && m<=5) return "ë´„";
  if(m>=6 && m<=8) return "ì—¬ë¦„";
  if(m>=9 && m<=11) return "ê°€ì„";
  return "ê²¨ìš¸";
}
function checkEvent(d){
  let m=d.getMonth()+1, day=d.getDate();
  for(let e of state.events){
    let [sm, sd] = e.start.split('/').map(Number);
    let [em, ed] = e.end.split('/').map(Number);
    if((m>sm || (m===sm && day>=sd)) && (m<em || (m===em && day<=ed))){
      return e.name;
    }
  }
  return "";
}
function updateDateDisplay(){
  let dateStr = formatDate(state.date);
  let season = getSeason(state.date);
  let ev = checkEvent(state.date);
  document.getElementById("dateDisplay").innerText =
    `ğŸ“… ${dateStr} Â· ${season}${ev ? " Â· "+ev : ""}`;
}

// =============== STUDENT LIST ===============
function renderStudentList(){
  let html = "";
  state.characters.forEach((c, idx)=>{
    html += `
      <div class="card">
        <b>${c.name}</b><br>
        í•™ë…„: ${c.grade}<br>
        ì„±ê²©: ${c.personality.join(", ")}<br>
        â¤ï¸í˜¸ê°ë„:
        ${state.characters.map(o=>""
          +(o.name !== c.name ?
            `${o.name}: ${c.relationships[o.name]||0}<br>`:"")).join("")}
        <button onclick="editForm(${idx})">âœï¸ í¸ì§‘</button>
      </div>
    `;
  });
  document.getElementById("studentList").innerHTML = html;
}
function showAddForm(){
  document.getElementById("studentList").innerHTML = `
    <div class="card">
      ì´ë¦„ <input id="nameField" type="text"><br>
      í•™ë…„ <input id="gradeField" type="number" min="1" max="3" value="1"><br>
      ì„±ê²©(ì‰¼í‘œ) <input id="personField" type="text"><br>
      <button onclick="addCharacter()">ì¶”ê°€</button>
    </div>
  `;
}
function addCharacter(){
  let name = document.getElementById("nameField").value.trim();
  let grade = Number(document.getElementById("gradeField").value);
  let pers = document.getElementById("personField").value
              .split(",").map(s=>s.trim()).filter(Boolean);
  if(!name || !grade || pers.length===0){
    alert("ëª¨ë“  í•­ëª© ì…ë ¥ í•„ìš”");
    return;
  }
  let rel = {};
  state.characters.forEach(x=>rel[x.name]=0);
  let newChar = {name, grade, personality:pers, relationships:rel, eventTriggered:[]};
  // add new char to others
  state.characters.forEach(x=> x.relationships[name]=0);
  state.characters.push(newChar);
  renderStudentList();
}

// edit
function editForm(i){
  let c = state.characters[i];
  document.getElementById("studentList").innerHTML = `
    <div class="card">
      ì´ë¦„ <input id="nameField" type="text" value="${c.name}"><br>
      í•™ë…„ <input id="gradeField" type="number" min="1" max="3" value="${c.grade}"><br>
      ì„±ê²©(ì‰¼í‘œ) <input id="personField" type="text" value="${c.personality.join(", ")}"><br>
      <button onclick="saveCharacter(${i})">ì €ì¥</button>
    </div>
  `;
}
function saveCharacter(i){
  let c = state.characters[i];
  c.name = document.getElementById("nameField").value.trim();
  c.grade = Number(document.getElementById("gradeField").value);
  c.personality = document.getElementById("personField").value
                     .split(",").map(s=>s.trim()).filter(Boolean);
  renderStudentList();
}

// =============== RELATIONSHIP VIEW ===============
function displayRelations(){
  if(state.characters.length < 2){
    alert("ìºë¦­í„°ê°€ 2ëª… ì´ìƒì´ì–´ì•¼ ê´€ê³„ë„ í‘œì‹œ ê°€ëŠ¥");
    return;
  }
  let html = "<div class='card'><b>ê´€ê³„ë„</b><br>";
  state.characters.forEach((c)=>{
    state.characters.forEach((o)=>{
      if(c.name !== o.name){
        let val = c.relationships[o.name]||0;
        let arrow = val > 50 ? "â¤" : "â€”";
        html += `${c.name} ${arrow} ${o.name} (${val})<br>`;
      }
    });
  });
  html += "</div>";
  document.getElementById("studentList").innerHTML = html;
}

// =============== DAILY LOGS =================
function scrollToLogs(){
  document.getElementById("logContent").scrollTop =
    document.getElementById("logContent").scrollHeight;
}
function clearLogs(){
  if(confirm("ê¸°ë¡ë§Œ ì‚­ì œí•©ë‹ˆë‹¤ (ìºë¦­í„°/ê´€ê³„ ìœ ì§€)")) {
    state.dailyLogs = [];
    document.getElementById("logContent").innerHTML = "";
  }
}

// =============== ADVANCE DAY & CREATE LOG ===============
function advanceDay(){
  state.date.setDate(state.date.getDate()+1);
  createDailyLog();
  updateDateDisplay();
}

function createDailyLog(){
  let dateStr = formatDate(state.date);
  let season = getSeason(state.date);
  let ev = checkEvent(state.date)||"";

  let log = `<div class="card"><b>${dateStr} Â· ${season}${ev? " Â· " + ev : ""}</b><br>`;

  state.characters.forEach(c=>{
    let actions = ["ìˆ˜ì—…ì„ ë“¤ì—ˆë‹¤","ì¹œêµ¬ì™€ ì´ì•¼ê¸°í–ˆë‹¤","ìš´ë™ì¥ì—ì„œ ì‹œê°„ì„ ë³´ëƒˆë‹¤","ì±…ì„ ì½ì—ˆë‹¤","ê°„ì‹ì„ ë¨¹ì—ˆë‹¤"];
    let mood = c.personality.includes("í™œë°œ") ? "í™œë°œí•˜ê²Œ" :
               c.personality.includes("ì¡°ìš©") ? "ì¡°ìš©íˆ" : "í‰ë²”í•˜ê²Œ";
    let act = actions[Math.floor(Math.random()*actions.length)];
    log += `${c.name}ëŠ” ${mood} ${act}.<br>`;

    // ê´€ê³„ ë³€í™”
    state.characters.forEach(o=>{
      if(c.name !== o.name){
        let delta = Math.floor(Math.random()*11) - 5;
        c.relationships[o.name] = (c.relationships[o.name]||0) + delta;
        if(delta>0){
          log += `<div class="event-card">${c.name}ì™€ ${o.name}ì˜ í˜¸ê°ë„ê°€ +${delta} ìƒìŠ¹!</div>`;
        } else if(delta<0){
          log += `<div class="relation-card">${c.name}ì™€ ${o.name}ì˜ ê´€ê³„ê°€ ì¡°ê¸ˆ ì†Œì›í•´ì¡Œë‹¤ (${delta})</div>`;
        }
        if(c.relationships[o.name] >= 70 && !c.eventTriggered.includes(o.name)){
          c.eventTriggered.push(o.name);
          log += `<div class="event-card">${c.name}ê³¼ ${o.name}ì€ ì¢‹ì€ ì‹œê°„ì„ ê°€ì§„ í›„ ë‹¤ìŒë¶€í„° ê°™ì´ í•˜êµí•˜ê¸°ë¡œ í–ˆë‹¤!</div>`;
        }
      }
    });
  });

  log += "</div>";
  state.dailyLogs.push(log);
  document.getElementById("logContent").innerHTML += log;
  scrollToLogs();
}

// init
updateDateDisplay();
renderStudentList();

</script>

</body>
</html>
