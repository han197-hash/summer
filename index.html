<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>여름 청춘 시뮬레이터</title>
<style>
  /* 폰트, 기본 스타일 */
  @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap');
  body {
    margin:0; padding:0; font-family: 'Gowun Dodum', sans-serif;
    background: #e0f2f7;
    color: #333;
    display: flex; flex-direction: column; height: 100vh;
  }
  header {
    background: #74b9ff;
    color: white; padding: 12px 20px; font-size: 1.5rem;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  #container {
    flex: 1; display: flex; padding: 10px; gap: 12px;
  }
  #leftPanel, #rightPanel {
    background: white;
    border-radius: 14px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.07);
    padding: 16px;
    display: flex; flex-direction: column;
  }
  #leftPanel {
    flex-basis: 350px;
    max-width: 350px;
  }
  #rightPanel {
    flex: 1;
  }
  h2 {
    margin: 0 0 12px 0;
    color: #0984e3;
    font-weight: 700;
    text-align: center;
  }
  #studentList {
    flex: 1;
    overflow-y: auto;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }
  .studentCard {
    background: #dff9fb;
    border-radius: 10px;
    padding: 8px 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    display: flex; flex-direction: column;
  }
  .studentCard strong {
    font-size: 1.1rem;
    color: #0984e3;
  }
  .traitList {
    margin: 6px 0 0 0;
    font-size: 0.85rem;
    color: #555;
  }
  .relStatus {
    margin-top: 6px;
    font-size: 0.8rem;
    color: #666;
    white-space: pre-line;
  }
  .btn-group {
    margin-top: 8px;
    display: flex; gap: 8px;
  }
  button {
    cursor: pointer;
    border: none;
    border-radius: 8px;
    padding: 6px 12px;
    font-size: 0.85rem;
    font-weight: 600;
    background: #74b9ff;
    color: white;
    transition: background 0.2s;
  }
  button:hover {
    background: #0984e3;
  }
  .btn-danger {
    background: #d63031;
  }
  .btn-danger:hover {
    background: #e17055;
  }
  #cancelEditBtn {
    background: #636e72;
  }
  #cancelEditBtn:hover {
    background: #2d3436;
  }
  form {
    margin-top: 16px;
    background: #f1f6f9;
    padding: 12px;
    border-radius: 12px;
  }
  label {
    display: block;
    font-weight: 600;
    margin-top: 8px;
  }
  input[type="text"], input[type="number"], select {
    width: 100%;
    border-radius: 6px;
    border: 1.5px solid #bbb;
    padding: 6px 8px;
    font-size: 1rem;
    margin-top: 4px;
  }
  input[type="text"]:focus, input[type="number"]:focus, select:focus {
    outline: none;
    border-color: #0984e3;
    box-shadow: 0 0 4px #74b9ff;
  }
  #traitsContainer {
    margin-top: 8px;
    min-height: 28px;
    display: flex; flex-wrap: wrap; gap: 6px;
  }
  .traitTag {
    background: #81ecec;
    padding: 4px 8px;
    border-radius: 16px;
    font-size: 0.85rem;
    color: #0984e3;
    user-select: none;
  }
  #initialLikesContainer {
    margin-top: 8px;
    max-height: 100px;
    overflow-y: auto;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 6px 10px;
  }
  .likeRow {
    display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;
  }
  .likeRow label {
    flex: 1;
  }
  .likeRow input {
    width: 60px;
    padding: 4px 6px;
    border-radius: 6px;
    border: 1.2px solid #bbb;
    text-align: center;
  }
  #dateTitle {
    font-weight: 700;
    text-align: center;
    margin-bottom: 8px;
    font-size: 1.2rem;
    color: #0984e3;
  }
  #dayLog {
    flex: 1;
    background: white;
    border-radius: 12px;
    padding: 12px;
    overflow-y: auto;
    font-size: 0.9rem;
    line-height: 1.4;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.04);
    margin-top: 10px;
  }
  .popup {
    padding: 8px 10px;
    border-radius: 10px;
    margin-bottom: 8px;
    line-height: 1.3;
    box-sizing: border-box;
  }
  .likeUp {
    background: #d6eaf8;
    color: #21618c;
  }
  .likeDown {
    background: #f5b7b1;
    color: #b03a2e;
  }
  .relationChange {
    background: #dcd6f7;
    color: #4a3f99;
  }
  #btns {
    margin-top: 12px;
    display: flex; justify-content: center; gap: 20px;
  }
</style>
</head>
<body>
<header>여름 청춘 시뮬레이터</header>
<div id="container">
  <section id="leftPanel">
    <h2>학생 관리</h2>
    <div id="studentList" title="학생 명단"></div>
    <form id="charForm" autocomplete="off">
      <h3 id="formTitle">캐릭터 추가</h3>
      <label for="charNameInput">이름</label>
      <input type="text" id="charNameInput" required placeholder="이름 입력" />
      <label for="charAgeInput">나이</label>
      <input type="number" id="charAgeInput" min="10" max="30" value="16" required />
      <label for="charGradeSelect">학년</label>
      <select id="charGradeSelect">
        <option value="1">1학년</option>
        <option value="2">2학년</option>
        <option value="3">3학년</option>
      </select>
      <label for="traitInput">성격 키워드 (엔터로 추가)</label>
      <input type="text" id="traitInput" placeholder="예: 활발한" />
      <div id="traitsContainer"></div>

      <label>초기 호감도 설정</label>
      <div id="initialLikesContainer" title="다른 캐릭터에 대한 초기 호감도 입력"></div>

      <div id="btns">
        <button type="submit" id="addCharBtn">추가</button>
        <button type="button" id="cancelEditBtn" style="display:none;">취소</button>
      </div>
    </form>
  </section>

  <section id="rightPanel">
    <div id="dateTitle">현재 날짜: 3월 2일 (입학식)</div>
    <div id="dayLog"></div>
    <div id="btns">
      <button id="nextDayBtn">다음 날</button>
      <button id="clearLogBtn">기록 삭제</button>
    </div>
  </section>
</div>

<script>
  const state = {
    characters: [],
    editingIndex: null,
    currentDate: new Date(new Date().getFullYear(), 2, 2),
  };

  // 이벤트 일정 간략 예시
  const events = [
    {name: '입학식', start: '2023-03-02', end: '2023-03-02'},
    {name: '1학기 중간고사', start: '2023-04-21', end: '2023-04-24'},
    {name: '1학기 기말고사', start: '2023-06-14', end: '2023-06-18'},
    {name: '여름방학', start: '2023-07-02', end: '2023-08-01'},
    {name: '수학여행', start: '2023-08-23', end: '2023-08-25'},
    {name: '체육대회', start: '2023-09-04', end: '2023-09-04'},
    {name: '2학기 중간고사', start: '2023-10-21', end: '2023-10-25'},
    {name: '2학기 기말고사', start: '2023-12-11', end: '2023-12-15'},
    {name: '종업식/졸업식', start: '2024-02-14', end: '2024-02-14'},
    {name: '봄방학', start: '2024-02-15', end: '2024-03-01'},
  ];

  const studentListDiv = document.getElementById('studentList');
  const charForm = document.getElementById('charForm');
  const charNameInput = document.getElementById('charNameInput');
  const charAgeInput = document.getElementById('charAgeInput');
  const charGradeSelect = document.getElementById('charGradeSelect');
  const traitInput = document.getElementById('traitInput');
  const traitsContainer = document.getElementById('traitsContainer');
  const initialLikesContainer = document.getElementById('initialLikesContainer');
  const addCharBtn = document.getElementById('addCharBtn');
  const cancelEditBtn = document.getElementById('cancelEditBtn');
  const dateTitle = document.getElementById('dateTitle');
  const dayLog = document.getElementById('dayLog');
  const nextDayBtn = document.getElementById('nextDayBtn');
  const clearLogBtn = document.getElementById('clearLogBtn');

  let currentTraits = [];

  traitInput.addEventListener('keydown', e => {
    if(e.key === 'Enter'){
      e.preventDefault();
      const val = traitInput.value.trim();
      if(val && !currentTraits.includes(val)){
        currentTraits.push(val);
        renderTraits();
        traitInput.value = '';
      }
    }
  });

  function renderTraits(){
    traitsContainer.innerHTML = '';
    currentTraits.forEach(trait => {
      const span = document.createElement('span');
      span.className = 'traitTag';
      span.textContent = trait;
      traitsContainer.appendChild(span);
    });
  }

  function updateInitialLikesUI(){
    initialLikesContainer.innerHTML = '';
    const editingIdx = state.editingIndex;
    const curCharName = editingIdx !== null ? state.characters[editingIdx].name : null;
    state.characters.forEach(char => {
      if(char.name === curCharName) return;
      const div = document.createElement('div');
      div.className = 'likeRow';
      const label = document.createElement('label');
      label.textContent = char.name;
      const input = document.createElement('input');
      input.type = 'number';
      input.min = -50;
      input.max = 100;
      input.value = editingIdx !== null ? (state.characters[editingIdx].relationships[char.name] || 0) : 0;
      input.dataset.target = char.name;
      div.appendChild(label);
      div.appendChild(input);
      initialLikesContainer.appendChild(div);
    });
  }

  function renderStudentList(){
    studentListDiv.innerHTML = '';
    state.characters.forEach((char, idx) => {
      const card = document.createElement('div');
      card.className = 'studentCard';
      const nameElem = document.createElement('strong');
      nameElem.textContent = `${char.name} (${char.grade}학년)`;
      card.appendChild(nameElem);
      const ageElem = document.createElement('div');
      ageElem.textContent = `나이: ${char.age}`;
      card.appendChild(ageElem);
      const traitElem = document.createElement('div');
      traitElem.className = 'traitList';
      traitElem.textContent = '성격: ' + (char.traits.length ? char.traits.join(', ') : '-');
      card.appendChild(traitElem);

      // 관계 상태 및 호감도 수치 텍스트로 표시
      const relDiv = document.createElement('div');
      relDiv.className = 'relStatus';
      let relStr = '';
      for(let targetName in char.relationships){
        const val = char.relationships[targetName];
        let status = '무관심';
        if(val >= 80) status = '약혼자';
        else if(val >= 50) status = '연인';
        else if(val >= 20) status = '썸';
        else if(val > 0) status = '짝사랑';
        else if(val < 0) status = '적대';
        relStr += `${targetName}: ${status} (${val})\n`;
      }
      relDiv.textContent = relStr.trim();
      card.appendChild(relDiv);

      const btnGroup = document.createElement('div');
      btnGroup.className = 'btn-group';

      const editBtn = document.createElement('button');
      editBtn.textContent = '수정';
      editBtn.onclick = () => {
        state.editingIndex = idx;
        charNameInput.value = char.name;
        charAgeInput.value = char.age;
        charGradeSelect.value = char.grade;
        charGradeSelect.disabled = true;
        currentTraits = [...char.traits];
        renderTraits();
        addCharBtn.textContent = '수정';
        cancelEditBtn.style.display = 'inline-block';
        updateInitialLikesUI();
      };
      btnGroup.appendChild(editBtn);

      const delBtn = document.createElement('button');
      delBtn.textContent = '삭제';
      delBtn.className = 'btn-danger';
      delBtn.onclick = () => {
        if(confirm(`${char.name} 캐릭터를 삭제하시겠습니까?`)){
          state.characters.forEach(c => {
            delete c.relationships[char.name];
          });
          state.characters.splice(idx, 1);
          if(state.editingIndex === idx){
            resetForm();
          }
          renderStudentList();
        }
      };
      btnGroup.appendChild(delBtn);
      card.appendChild(btnGroup);

      studentListDiv.appendChild(card);
    });
  }

  function resetForm(){
    charForm.reset();
    charGradeSelect.disabled = false;
    currentTraits = [];
    renderTraits();
    state.editingIndex = null;
    addCharBtn.textContent = '추가';
    cancelEditBtn.style.display = 'none';
    updateInitialLikesUI();
  }

  charForm.addEventListener('submit', e => {
    e.preventDefault();
    const name = charNameInput.value.trim();
    const age = Number(charAgeInput.value);
    const grade = Number(charGradeSelect.value);
    const traits = [...currentTraits];

    if(!name) return alert('이름을 입력하세요.');

    if(state.editingIndex !== null){
      const char = state.characters[state.editingIndex];
      char.name = name;
      char.age = age;
      char.traits = traits;
      // 호감도 업데이트
      const inputs = initialLikesContainer.querySelectorAll('input');
      inputs.forEach(input => {
        const target = input.dataset.target;
        char.relationships[target] = Number(input.value);
      });
      resetForm();
    } else {
      // 새 캐릭터 추가
      const newChar = {
        name, age, grade, traits,
        relationships: {}
      };
      // 초기 호감도 0으로 채우기
      state.characters.forEach(c => {
        c.relationships[name] = 0;
        newChar.relationships[c.name] = 0;
      });
      state.characters.push(newChar);
      resetForm();
    }
    renderStudentList();
  });

  cancelEditBtn.addEventListener('click', () => {
    resetForm();
  });

  // 날짜 표시 및 다음날 버튼 기능 (생략, 기존 방식 사용)
  // 이벤트 및 서술 생성도 기존 방식 유지
  // ...
  // 아래에 이전처럼 날짜 진행, 이벤트 체크, 서술 생성 로직 구현하세요.

  // 로그 기록 초기화 버튼
  clearLogBtn.addEventListener('click', () => {
    if(confirm('지금까지의 기록을 모두 삭제하시겠습니까?')){
      dayLog.textContent = '';
    }
  });

  // 다음 날 버튼 클릭 시 날짜 + 이벤트/서술 처리 (기존 로직 참조)
  nextDayBtn.addEventListener('click', () => {
    // 날짜 증가
    state.currentDate.setDate(state.currentDate.getDate() + 1);

    // 날짜 표시 업데이트
    const month = state.currentDate.getMonth() + 1;
    const date = state.currentDate.getDate();

    // 오늘 해당하는 이벤트 찾아서 괄호로 표시
    let todayEventName = '';
    const curDateStr = state.currentDate.toISOString().slice(0,10);
    for(let ev of events){
      if(curDateStr >= ev.start && curDateStr <= ev.end){
        todayEventName = ev.name;
        break;
      }
    }

    dateTitle.textContent = `현재 날짜: ${month}월 ${date}일${todayEventName ? ' (' + todayEventName + ')' : ''}`;

    // 오늘 사건, 서술 랜덤 생성 (여기서 호감도 증감, 관계 변화 로그 생성)
    // 간단 예시:
    const logs = [];

    // 예시 - 공부 이벤트
    if(todayEventName.includes('중간고사') || todayEventName.includes('기말고사')){
      logs.push(`오늘은 ${todayEventName} 기간이라 열심히 공부했다. 어려운 문제에서 막혔다.`);
    }

    // 예시 - 비 오는 날과 우산 이벤트 (임의로 날짜 조건 설정)
    if(month === 4 && date === 15){ // 임의로 4월 15일 비오는 날 예시
      logs.push('비가 왔지만 우산을 가져오지 않았다. 그러나 ㅇㅇ이가 우산을 같이 쓰자고 제안했다.');
    }

    // 호감도 변화(임의 랜덤, 실제는 사용자 이벤트에 따라 다름)
    if(state.characters.length >= 2){
      const c1 = state.characters[0];
      const c2 = state.characters[1];
      // 호감도 5 증가
      c1.relationships[c2.name] = (c1.relationships[c2.name] || 0) + 5;
      c2.relationships[c1.name] = (c2.relationships[c1.name] || 0) + 5;
      logs.push(`❤️ ${c1.name}와 ${c2.name}의 호감도가 5만큼 올랐다.`);
    }

    // 기록 띄우기
    logs.forEach(log => {
      const div = document.createElement('div');
      div.className = log.includes('❤️') ? 'relationChange' : 'likeUp';
      div.textContent = log;
      dayLog.prepend(div);
    });

    renderStudentList();
  });

  // 초기화
  resetForm();
  renderStudentList();

</script>
</body>
</html>
